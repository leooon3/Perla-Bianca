<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Area Riservata Â· I Sarcofagi del Re</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="css/admin.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
    <link rel="icon" href="./img/logo.ico" type="image/ico" />

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/it.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
  </head>

  <body>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         LOGIN SCREEN
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="loginScreen">
      <div class="login-card">
        <div class="login-logo">
          <img src="img/logo+text.png" alt="I Sarcofagi del Re" />
          <h1>Area Riservata</h1>
          <p>Pannello di gestione</p>
        </div>

        <div id="googleBtnContainer" style="display:flex; justify-content:center; height:44px; margin-bottom:1rem;"></div>

        <div class="login-divider"><span>Oppure email</span></div>

        <form id="emailAuthForm">
          <div id="step1">
            <input type="email" id="emailInput" class="login-input" placeholder="tua@email.com" autocomplete="email" required />
            <button type="submit" class="lbtn lbtn-navy">Ricevi Codice</button>
          </div>
          <div id="step2" class="hidden">
            <p class="otp-hint">Inserisci il codice ricevuto via mail:</p>
            <input type="text" id="otpInput" class="login-input otp-input" placeholder="123456" maxlength="6" inputmode="numeric" />
            <button type="button" id="verifyBtn" class="lbtn lbtn-terra">Accedi</button>
            <button type="button" id="backBtn" class="lbtn-link">Cambia indirizzo mail</button>
          </div>
        </form>

        <p id="errorMsg" class="hidden"></p>
      </div>
    </div>


    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         DASHBOARD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="dashboard" class="hidden" style="min-height:100vh; display:flex; flex-direction:column;">

      <!-- Top Nav -->
      <nav class="top-nav">
        <a href="/" class="nav-logo">
          <img src="img/logo.png" alt="Logo" />
          <div>
            <div class="nav-logo-name">I Sarcofagi del Re</div>
            <div class="nav-logo-sub">Pannello di controllo</div>
          </div>
        </a>

        <div class="nav-sections">
          <button class="nav-sec-btn active" id="navBtnDashboard" data-section="dashboard" onclick="app.showSection('dashboard')">
            Dashboard
          </button>
          <button class="nav-sec-btn" id="navBtnCalendario" data-section="calendario" onclick="app.showSection('calendario')">
            Calendario
            <span class="nav-badge hidden" id="badgeCal">0</span>
          </button>
          <button class="nav-sec-btn" id="navBtnRecensioni" data-section="recensioni" onclick="app.showSection('recensioni')">
            Recensioni
            <span class="nav-badge hidden" id="badgeRev">0</span>
          </button>
          <button class="nav-sec-btn" id="navBtnMessaggi" data-section="messaggi" onclick="app.showSection('messaggi')">
            Messaggi
            <span class="nav-badge hidden" id="badgeMsg">0</span>
          </button>
          <button class="nav-sec-btn" id="navBtnPrezzi" data-section="prezzi" onclick="app.showSection('prezzi')">
            Prezzi
          </button>
          <button class="nav-sec-btn" id="navBtnLog" data-section="log" onclick="app.showSection('log')">
            Log
          </button>
        </div>

        <div class="nav-right">
          <div class="prop-wrap" id="propWrap">
            <button class="prop-btn" id="propBtn" onclick="app.togglePropMenu()">
              <span id="propLabel">Perla Bianca</span>
              <svg viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2.5">
                <polyline points="2,4 6,8 10,4"/>
              </svg>
            </button>
            <div class="prop-menu hidden" id="propMenu"></div>
          </div>
          <button id="logoutBtn" class="logout-btn">Esci</button>
        </div>
      </nav>

      <!-- Main -->
      <main class="main" style="flex:1;">

        <!-- â”€â”€ DASHBOARD STATISTICHE â”€â”€ -->
        <section id="sectionDashboard" class="section active">
          <div class="sec-hd">
            <div>
              <h2 class="sec-title">Dashboard</h2>
              <p class="sec-sub">Riepilogo attivitÃ  â€” <span id="dashPropLabel">Perla Bianca</span></p>
            </div>
          </div>
          <div id="dashboardContent">
            <div class="dash-loading">Caricamento...</div>
          </div>
        </section>

        <!-- â”€â”€ CALENDARIO â”€â”€ -->
        <section id="sectionCalendario" class="section">
          <div class="sec-hd">
            <div>
              <h2 class="sec-title">Calendario</h2>
              <p class="sec-sub">Clicca su un giorno per aggiungere una prenotazione</p>
            </div>
            <div style="display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap;">
              <button class="btn-block-period" onclick="app.openBlockModal()">ðŸ”’ Blocca periodo</button>
              <button class="btn-block-period" id="btnExportCal" onclick="app.exportCalendarCSV()">ðŸ“¥ Esporta CSV</button>
              <button class="btn-add" onclick="app.openAddModal()">
                + Nuova prenotazione
              </button>
            </div>
          </div>
          <div id="calendarEl"></div>
        </section>

        <!-- â”€â”€ RECENSIONI â”€â”€ -->
        <section id="sectionRecensioni" class="section">
          <div class="sec-hd">
            <div>
              <h2 class="sec-title">Recensioni</h2>
            </div>
            <button class="btn-block-period" id="btnExportRev" onclick="app.exportReviewsCSV()">ðŸ“¥ Esporta CSV</button>
          </div>
          <div class="rev-tabs">
            <button class="rev-tab active" id="revTabAttesa" onclick="app.switchReviewTab('attesa')">
              In attesa
              <span class="rev-count zero" id="countAttesa">0</span>
            </button>
            <button class="rev-tab" id="revTabPubbliche" onclick="app.switchReviewTab('pubblicate')">
              Pubblicate
            </button>
          </div>
          <div id="reviewsList" class="reviews-list"></div>
        </section>

        <!-- â”€â”€ MESSAGGI â”€â”€ -->
        <section id="sectionMessaggi" class="section">
          <div class="sec-hd">
            <div>
              <h2 class="sec-title">Messaggi</h2>
              <p class="sec-sub">Richieste dal form contatti</p>
            </div>
          </div>
          <div class="msg-tabs">
            <button class="rev-tab active" id="msgTabNuovi" onclick="app.switchMsgTab('nuovi')">Non letti</button>
            <button class="rev-tab" id="msgTabTutti" onclick="app.switchMsgTab('tutti')">Tutti</button>
          </div>
          <div id="messaggiList" class="msg-list"></div>
        </section>

        <!-- â”€â”€ PREZZI â”€â”€ -->
        <section id="sectionPrezzi" class="section">
          <div class="sec-hd">
            <div>
              <h2 class="sec-title">Prezzi</h2>
              <p class="sec-sub">Tariffe per stagione â€” <span id="prezziPropLabel">Perla Bianca</span></p>
            </div>
            <button class="btn-add" onclick="app.addPriceRow()">+ Aggiungi stagione</button>
          </div>
          <div id="prezziEditor" class="prezzi-editor">
            <div class="dash-loading">Caricamento prezzi...</div>
          </div>
          <div class="prezzi-actions">
            <button class="btn-submit" id="btnSavePrices" onclick="app.savePrices()">ðŸ’¾ Salva prezzi</button>
          </div>
        </section>

        <!-- â”€â”€ LOG ATTIVITÃ€ â”€â”€ -->
        <section id="sectionLog" class="section">
          <div class="sec-hd">
            <div>
              <h2 class="sec-title">Log AttivitÃ </h2>
              <p class="sec-sub">Ultime 100 azioni eseguite dagli admin</p>
            </div>
          </div>
          <div id="logList" class="log-list"></div>
        </section>

      </main>
    </div>


    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MODAL: Aggiungi prenotazione
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="addModal" class="modal hidden">
      <div class="modal-card" id="addModalCard">
        <div class="modal-hd">
          <h3 class="modal-title">Nuova prenotazione</h3>
          <button class="modal-close" onclick="app.closeAddModal()">Ã—</button>
        </div>
        <form id="addEventForm">
          <div class="form-check">
            <input type="checkbox" id="isBlockedDate" />
            <label for="isBlockedDate">Chiuso / Manutenzione</label>
          </div>
          <div class="form-group">
            <label class="form-label" for="eventName">Nome ospite</label>
            <input type="text" id="eventName" class="form-field" placeholder="Es. Mario Rossi" required />
          </div>
          <div class="form-group">
            <label class="form-label" for="eventDates">Date</label>
            <input type="text" id="eventDates" class="form-field" placeholder="Seleziona date..." readonly />
          </div>
          <div class="form-group">
            <label class="form-label" for="eventNotes">Note interne</label>
            <textarea id="eventNotes" class="form-field form-textarea" placeholder="Pagamento, telefono..."></textarea>
          </div>
          <button type="submit" class="btn-submit">Salva prenotazione</button>
        </form>
      </div>
    </div>


    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MODAL: Blocco periodo
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="blockModal" class="modal hidden">
      <div class="modal-card">
        <div class="modal-hd">
          <h3 class="modal-title">Blocca periodo</h3>
          <button class="modal-close" onclick="app.closeBlockModal()">Ã—</button>
        </div>
        <form id="blockForm">
          <div class="form-group">
            <label class="form-label" for="blockType">Tipo di blocco</label>
            <select id="blockType" class="form-field">
              <option value="Chiuso">ðŸ”´ Chiuso</option>
              <option value="Manutenzione">ðŸ”§ Manutenzione</option>
              <option value="Pulizia">ðŸ§¹ Pulizia</option>
              <option value="Riservato">ðŸ“Œ Riservato</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="blockDates">Date</label>
            <input type="text" id="blockDates" class="form-field" placeholder="Seleziona date..." readonly />
          </div>
          <div class="form-group">
            <label class="form-label" for="blockNotes">Note (opzionale)</label>
            <textarea id="blockNotes" class="form-field form-textarea" placeholder="Es. Manutenzione caldaia..."></textarea>
          </div>
          <button type="submit" class="btn-submit">Blocca periodo</button>
        </form>
      </div>
    </div>


    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MODAL: Dettaglio evento
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="eventModal" class="modal hidden">
      <div class="modal-card" id="eventModalCard">
        <div id="eventModalContent"></div>
      </div>
    </div>


    <script src="js/admin.js"></script>
  </body>
</html>
